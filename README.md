# Link-contractor-api
Этот проект - бот-сокращатель ссылок

На данный бот работает для ВК и для DEV режима

Архитектура бота написана после вдохновления книгой Роберта Мартина "Чистая архитектура"

## Этапы создания бота

В первую очередь были определены основные сценарии использования приложения - 
* Создание ссылки
* Деактивация ссылки
* Активация ссылки
* Список ссылок пользователя
    + Активные и неактивные
    + Только активные

После этого были написаны основные юзкейсы, контроллеры, был написан менеджер фраз и заглушки репозиториев

Все компоненты были написаны с соблюдением правила зависимости - "Компоненты низкого уровня должны зависеть от компонентов более высокого уровня"

После этого был составлен граф зависимостей компонентов, который можно посмотреть по [ссылке](https://lucid.app/lucidchart/fc0c9ca6-e924-48c1-b61e-c66addd97720/edit?invitationId=inv_de442d2b-7efd-4a22-8dc8-413cc0f47aff#)

Граф был составлен по следующим причинам 
* Посмотреть, соответствуют ли компоненты принципу ацикличности зависимостей
* Соотвествуют ли зависимости принципу устойчивых зависимостей
  + для этого были составлены метрики устойчивости для каждого компонента, компоненты Presenter и Dependencies зависят практически от каждого компонента, поэтому они выделены в овал и у них не указаны стрелочки.
    красным выделена зависимость, которая не соотвествует принципу, для этого был создан новый компонент Response, от которого зависят опа компонента

После этого были написаны манифесты для разворачивания проекта в проде и разворачивания базы на деве

Для того, чтобы развернуть проект в проде достаточно заполнить конфиг 
**config/prod.env**
и сделать команду 
```
$ docker-compose -f docker-compose-prod.yaml up
```
Для того, чтобы понять, как составить кофниг **config/prod.env** есть **config/example.env** , по которому можно посмотреть, какие параметры за что отвечают

## Как бы я расширил проект
Сейчас редирект происходит в этом же проекте, что не удобно и не масштабируемо.
Одно из первых расширений, которое я бы предпринял - перенос редиректа в отдельный сервис, далее редиректор. 
Отправка на редиректор делалась бы либо синхроно через grpc либо асинхроно через очередь.

Данное решение могло бы масштабировать редиректор в случае высокой нагрузки, но в тоже время добавило бы сложности проекта в плане синхронизации данных между ботом и редиректором

Второе расширение - добавление статистики о переходах по ссылкам, которую бы собирал редиректор, такую информацию можно было бы хранить в clickhouse

Третье расширение - добавление банлиста для пользователя, на данный момент есть таблица под это и функционал проверки, но нет функционала добавления

Четвёртое расширение - сделал бы сборку проекта через компиляцию в докер контейнере, после чего готовый бинарь передавался бы в боевой контейнер, это помогло бы сэкономить места и не тянуть за собой либы в контейнер


## Какие ошибки я совершил 

* Для презентора **internal/presenter/** нужно было сделать отдельно словарь фраз, тогда бы их можно было переиспользовать в презенторах vk и dev
* Возможно слишком мелкое деление по пакетам для юзкейсов.
* Все репозиторные методы сразу имплементируют интерфейсы юзкейсов, это не очень хороший подход, ибо в таком случае теряется переиспользуемость кода. Более лучшим решением было бы следующее - 
 базовые приватные репозиторные методы, поверх которых написаны методы-адаптеры для интерфейсов юзкейсов, которые бы использовали приватные методы




